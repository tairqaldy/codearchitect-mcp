# CodeArchitect MCP

A Model Context Protocol (MCP) server that stores AI conversation sessions as markdown files in your project. Perfect for tracking development sessions, decisions, and conversations with AI assistants.

## Features

- üìù **Store Conversations**: Save AI conversation sessions as organized markdown files
- üóÇÔ∏è **Auto-Organization**: Automatically organizes sessions by date in `.codearchitect/sessions/`
- üîç **Smart Topic Extraction**: Automatically extracts session topics from conversations
- üöÄ **Zero Configuration**: Works out of the box with auto-detected project roots
- ‚ö° **Fast & Reliable**: Optimized for performance with comprehensive error handling
- üîí **Secure**: Validates file paths and prevents directory traversal attacks

## Installation

### Prerequisites

- Node.js 18.0.0 or higher
- npm or yarn

### Install from npm (when published)

```bash
npm install -g codearchitect-mcp
```

### Install from source

```bash
git clone https://github.com/tairqaldy/codearchitect-mcp.git
cd codearchitect-mcp
npm install
npm run build
npm link
```

## Setup in Cursor/VS Code

### Cursor

Add to your Cursor MCP settings (`~/.cursor/mcp.json` or workspace settings):

```json
{
  "mcpServers": {
    "codearchitect": {
      "command": "codearchitect-mcp"
    }
  }
}
```

### VS Code

Add to your VS Code settings (`.vscode/settings.json`):

```json
{
  "mcp.servers": {
    "codearchitect": {
      "command": "codearchitect-mcp"
    }
  }
}
```

## Usage

Once configured, you can use the `store_session` tool from your AI assistant:

### Basic Usage

```
Store this conversation about implementing authentication
```

The tool will:
1. Extract the topic from your conversation
2. Detect your project root
3. Create the directory structure: `.codearchitect/sessions/YYYY-MM-DD/`
4. Save the session as: `session-YYYYMMDD-HHMMSS-topic-slug.md`

### With Explicit Topic

```
Store this session with topic "User Authentication Implementation"
```

### Example Output

Sessions are saved in markdown format:

```markdown
# implement-user-authentication

**Date:** 2025-01-15T14:30:22.123Z
**Type:** AI Conversation Session

---

## Conversation

User: I need to add authentication to my app
AI: Let's implement JWT-based authentication...

---

*Generated by CodeArchitect MCP v0.1.0*
```

## File Structure

Sessions are organized by date in your project:

```
your-project/
‚îú‚îÄ‚îÄ .codearchitect/
‚îÇ   ‚îî‚îÄ‚îÄ sessions/
‚îÇ       ‚îú‚îÄ‚îÄ 2025-01-15/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ session-20250115-143022-implement-auth.md
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ session-20250115-150145-add-database.md
‚îÇ       ‚îî‚îÄ‚îÄ 2025-01-16/
‚îÇ           ‚îî‚îÄ‚îÄ session-20250116-091200-refactor-api.md
‚îî‚îÄ‚îÄ (your code)
```

## API Reference

### Tool: `store_session`

Stores an AI conversation session as a markdown file.

#### Parameters

- `conversation` (string | array, required): The conversation text or array of messages
- `topic` (string, optional): Session topic/title. Auto-extracted if not provided
- `format` (string, optional): Format of conversation input
  - `"plain"` (default): Plain text conversation
  - `"messages"`: JSON array of message objects with `role` and `content`

#### Response

Success:
```json
{
  "success": true,
  "file": "/path/to/project/.codearchitect/sessions/2025-01-15/session-20250115-143022-topic.md",
  "filename": "session-20250115-143022-topic.md",
  "topic": "topic",
  "date": "2025-01-15T14:30:22.123Z",
  "message": "Session saved to session-20250115-143022-topic.md"
}
```

Error:
```json
{
  "success": false,
  "error": "INVALID_INPUT",
  "message": "Conversation parameter is required",
  "details": "..."
}
```

## Project Root Detection

The server automatically detects your project root by looking for:

- `package.json`
- `.git`
- `.codearchitect`
- `Cargo.toml` (Rust)
- `go.mod` (Go)
- `requirements.txt` (Python)
- `pom.xml` (Java)
- `project.json` (.NET)

If no markers are found, it uses the current working directory.

## Topic Extraction

Topics are extracted in this priority order:

1. **User-provided topic**: If you specify a topic, it's used directly
2. **User message**: Extracts from lines starting with "User:"
3. **First line**: Uses the first non-empty line if reasonable length
4. **Keywords**: Extracts keywords from the first 200 characters
5. **Fallback**: Uses timestamp-based name

Topics are automatically sanitized to be URL-safe (lowercase, hyphens, max 50 chars).

## Error Handling

The server handles various error scenarios gracefully:

- **INVALID_INPUT**: Missing or invalid conversation parameter
- **PROJECT_ROOT_NOT_FOUND**: Cannot detect project root (non-fatal, uses current dir)
- **FILE_WRITE_ERROR**: Cannot write file (permissions, disk full)
- **FILENAME_GENERATION_ERROR**: Cannot generate unique filename
- **DIRECTORY_CREATION_ERROR**: Cannot create directory
- **UNKNOWN_ERROR**: Unexpected error

## Troubleshooting

### Session files not being created

1. **Check permissions**: Ensure you have write permissions in your project directory
2. **Check project root**: Verify the server detected your project root correctly
3. **Check logs**: Look for error messages in the MCP server logs

### Topic extraction not working

- Provide an explicit `topic` parameter
- Ensure your conversation starts with a clear user message
- Topics are limited to 50 characters and special characters are removed

### Files saved in wrong location

- The server uses project root detection - ensure you're in a project directory
- Check for `.codearchitect` folder in your project root
- Sessions are always saved relative to the detected project root

### Permission errors

- Ensure you have write permissions in your project directory
- On Linux/Mac, check directory permissions with `ls -la`
- On Windows, ensure you're not in a protected directory

## Development

### Building

```bash
npm install
npm run build
```

### Testing

```bash
npm test
npm run test:coverage
```

### Running in Development

```bash
npm run dev
```

## Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## License

MIT License - see [LICENSE](LICENSE) file for details.

## Support

- **Issues**: [GitHub Issues](https://github.com/tairqaldy/codearchitect-mcp/issues)
- **Documentation**: See [docs/](./docs/) folder for detailed documentation

## Roadmap

Future features planned:

- `get_session` - Retrieve session by date/topic
- `list_sessions` - Browse all sessions
- `search_sessions` - Full-text search across sessions
- Configuration file support
- Optional database storage

## Changelog

### v0.1.0 (Current)

- Initial release
- `store_session` tool
- Auto project root detection
- Smart topic extraction
- Markdown formatting
- Comprehensive error handling

